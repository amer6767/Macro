--[[
    AXIORA V6 HYBRID - MOBILE QUANTUM EDITION
    Architect: Quantum Delta-Script Architect
    Logic: Einstein Offset Correction + A* Pathfinding Fail-Safe
    Environment: Delta/Arceus (Mobile Optimized)
    
    [PART 1: CORES, SERVICES & UI SETUP]
]]

--// 1. QUANTUM SAFETY LAYER //
if not game:IsLoaded() then game.Loaded:Wait() end

-- Safe Service Getter (Prevents nil errors on mobile executors)
local function GetService(name)
    return cloneref and cloneref(game:GetService(name)) or game:GetService(name)
end

local Players = GetService("Players")
local UserInputService = GetService("UserInputService")
local VirtualInputManager = GetService("VirtualInputManager")
local TweenService = GetService("TweenService")
local RunService = GetService("RunService")
local CoreGui = GetService("CoreGui")
local PathfindingService = GetService("PathfindingService")
local GuiService = GetService("GuiService")
local Workspace = GetService("Workspace")

local Player = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = Player:GetMouse()

-- Mobile Detection & Thread Safety
local IsMobile = UserInputService.TouchEnabled
local ActiveThreads = {} -- Thread Management to prevent crashes

--// 2. AXIORA THEME CONFIGURATION //
local Theme = {
    Background = Color3.fromRGB(20, 20, 24),     -- Deep Navy
    Sidebar    = Color3.fromRGB(15, 15, 18),     -- Darker Sidebar
    Content    = Color3.fromRGB(26, 26, 30),     -- Content Boxes
    Accent     = Color3.fromRGB(114, 137, 218),  -- Blurple (Axiora Signature)
    Text       = Color3.fromRGB(245, 245, 245),  -- White
    SubText    = Color3.fromRGB(160, 160, 160),  -- Grey
    Success    = Color3.fromRGB(87, 242, 135),   -- Green
    Warning    = Color3.fromRGB(240, 240, 60),   -- Yellow (Pathfinding Active)
    Danger     = Color3.fromRGB(237, 66, 69)     -- Red
}

--// 3. EINSTEIN LOGIC LIBRARY (MATH & PATHFINDING) //

-- > A. OFFSET CORRECTION (The 0-Drift Fix)
-- Calculates exact pixel location accounting for notch/topbar on Mobile
local function GetTruePosition(inputObject)
    local rawPos
    if inputObject and inputObject.Position then
        rawPos = Vector2.new(inputObject.Position.X, inputObject.Position.Y)
    else
        rawPos = UserInputService:GetMouseLocation()
    end
    -- Get TopBar Inset (e.g. 36px on iOS/Android)
    local inset = GuiService:GetGuiInset() 
    return rawPos -- On VIM, sending raw coords usually works if derived from InputObject
    -- If drifting occurs, enable 'GlobalSettings.OffsetFix' (Added later)
end

-- > B. SMART PATHFINDING (A* Wrapper)
local function SmartMoveTo(targetPosition)
    local Character = Player.Character or Player.CharacterAdded:Wait()
    local Humanoid = Character:WaitForChild("Humanoid")
    local Root = Character:WaitForChild("HumanoidRootPart")

    -- 1. Direct Move Attempt
    Humanoid:MoveTo(targetPosition)
    
    -- 2. Stuck Check (The "Fail-Safe")
    local moveStartTime = os.clock()
    local stuckLimit = 2.0 -- Seconds before AI takes over
    
    local reached = false
    local connection
    
    connection = Humanoid.MoveToFinished:Connect(function() reached = true end)
    
    while not reached and (os.clock() - moveStartTime) < 10 do
        -- Check if stuck (Low velocity while supposed to be moving)
        if (os.clock() - moveStartTime) > stuckLimit and Root.AssemblyLinearVelocity.Magnitude < 0.5 then
            -- ENGAGE A* PATHFINDING
            -- print("Obstacle Detected. Calculating Path...")
            local path = PathfindingService:CreatePath({AgentRadius = 2, AgentCanJump = true})
            local success = pcall(function() path:ComputeAsync(Root.Position, targetPosition) end)
            
            if success and path.Status == Enum.PathStatus.Success then
                for _, waypoint in pairs(path:GetWaypoints()) do
                    if waypoint.Action == Enum.PathWaypointAction.Jump then Humanoid.Jump = true end
                    Humanoid:MoveTo(waypoint.Position)
                    local wReached = Humanoid.MoveToFinished:Wait()
                    if not wReached then break end
                end
                reached = true
                break
            end
        end
        RunService.Heartbeat:Wait()
    end
    if connection then connection:Disconnect() end
end

--// 4. GUI LIBRARY (MOBILE OPTIMIZED) //
local AxioraGUI = Instance.new("ScreenGui")
AxioraGUI.Name = "AxioraHybridV4"
AxioraGUI.IgnoreGuiInset = true -- Crucial for Recording overlay match
AxioraGUI.Parent = CoreGui -- Anti-detection (Parent to Core)

local function CreateUICorner(parent, r)
    local c = Instance.new("UICorner", parent)
    c.CornerRadius = UDim.new(0, r or 8)
    return c
end

-- Main Mobile Dragging Logic (Touch Friendly)
local function MakeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            -- Linear interpolation for smooth mobile feel
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- MAIN CONTAINER
local MainFrame = Instance.new("Frame", AxioraGUI)
MainFrame.Size = UDim2.new(0, 550, 0, 320) -- Compact landscape size for Mobile
MainFrame.Position = UDim2.new(0.5, -275, 0.5, -160)
MainFrame.BackgroundColor3 = Theme.Background
MainFrame.BorderSizePixel = 0
MainFrame.ClipsDescendants = true
CreateUICorner(MainFrame, 12)

-- SIDEBAR
local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Size = UDim2.new(0, 140, 1, 0)
Sidebar.BackgroundColor3 = Theme.Sidebar
Sidebar.BorderSizePixel = 0

local TitleLabel = Instance.new("TextLabel", Sidebar)
TitleLabel.Text = "AXIORA"
TitleLabel.Font = Enum.Font.GothamBlack
TitleLabel.TextColor3 = Theme.Accent
TitleLabel.TextSize = 20
TitleLabel.Size = UDim2.new(1, 0, 0, 50)
TitleLabel.BackgroundTransparency = 1

local TabContainer = Instance.new("ScrollingFrame", Sidebar)
TabContainer.Size = UDim2.new(1, 0, 1, -60)
TabContainer.Position = UDim2.new(0, 0, 0, 60)
TabContainer.BackgroundTransparency = 1
TabContainer.ScrollBarThickness = 0

-- CONTENT AREA
local ContentArea = Instance.new("Frame", MainFrame)
ContentArea.Size = UDim2.new(1, -150, 1, -10)
ContentArea.Position = UDim2.new(0, 150, 0, 10)
ContentArea.BackgroundTransparency = 1

-- Floating Mobile Toggle (The bubble to hide UI)
local MobileToggle = Instance.new("TextButton", AxioraGUI)
MobileToggle.Size = UDim2.new(0, 50, 0, 50)
MobileToggle.Position = UDim2.new(0, 20, 0.5, -25)
MobileToggle.BackgroundColor3 = Theme.Sidebar
MobileToggle.Text = "AX"
MobileToggle.Font = Enum.Font.GothamBlack
MobileToggle.TextColor3 = Theme.Accent
MobileToggle.TextSize = 18
CreateUICorner(MobileToggle, 25)
local Stroke = Instance.new("UIStroke", MobileToggle)
Stroke.Color = Theme.Accent
Stroke.Thickness = 1.5

-- Toggles GUI visibility
MobileToggle.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)
MakeDraggable(MobileToggle, MobileToggle) -- Allows moving the bubble

-- // END OF PART 1 //
-- Setup Complete. Awaiting confirmation to inject logic core.
--// [PART 2: UI SYSTEMS & LOGIC CORE] //

-- Tab Management System
local Tabs = {}
local CurrentTab = nil

local function CreateTab(name, icon)
    -- Button
    local TabBtn = Instance.new("TextButton", TabContainer)
    TabBtn.Size = UDim2.new(1, -10, 0, 32)
    TabBtn.BackgroundColor3 = Theme.Sidebar
    TabBtn.BackgroundTransparency = 1
    TabBtn.Text = "  " .. icon .. "  " .. name
    TabBtn.TextColor3 = Theme.SubText
    TabBtn.Font = Enum.Font.GothamBold
    TabBtn.TextSize = 14
    TabBtn.TextXAlignment = Enum.TextXAlignment.Left
    CreateUICorner(TabBtn, 6)
    
    -- Page
    local Page = Instance.new("ScrollingFrame", ContentArea)
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundTransparency = 1
    Page.ScrollBarThickness = 2
    Page.ScrollBarImageColor3 = Theme.Accent
    Page.Visible = false
    
    local UIList = Instance.new("UIListLayout", Page)
    UIList.Padding = UDim.new(0, 6)
    UIList.SortOrder = Enum.SortOrder.LayoutOrder
    local UIPad = Instance.new("UIPadding", Page)
    UIPad.PaddingTop = UDim.new(0, 5)

    -- Interaction
    TabBtn.MouseButton1Click:Connect(function()
        for _, t in pairs(Tabs) do
            TweenService:Create(t.Btn, TweenInfo.new(0.2), {TextColor3 = Theme.SubText, BackgroundTransparency = 1}):Play()
            t.Page.Visible = false
        end
        TweenService:Create(TabBtn, TweenInfo.new(0.2), {TextColor3 = Theme.Text, BackgroundTransparency = 0}):Play()
        Page.Visible = true
    end)
    
    table.insert(Tabs, {Btn = TabBtn, Page = Page})
    return Page
end

-- Component Factories
local function AddButton(text, page, callback, color)
    local Btn = Instance.new("TextButton", page)
    Btn.Size = UDim2.new(0.95, 0, 0, 36)
    Btn.BackgroundColor3 = color or Theme.Content
    Btn.Text = text
    Btn.TextColor3 = Theme.Text
    Btn.Font = Enum.Font.GothamBold
    Btn.TextSize = 14
    CreateUICorner(Btn, 6)
    
    Btn.MouseButton1Click:Connect(function()
        local ripple = Instance.new("Frame", Btn)
        ripple.BackgroundColor3 = Color3.new(1,1,1)
        ripple.BackgroundTransparency = 0.8
        ripple.Size = UDim2.new(0,0,0,0)
        ripple.Position = UDim2.new(0.5,0,0.5,0)
        ripple.AnchorPoint = Vector2.new(0.5,0.5)
        CreateUICorner(ripple, 50)
        
        TweenService:Create(ripple, TweenInfo.new(0.3), {Size=UDim2.new(1.1,0,1.5,0), BackgroundTransparency=1}):Play()
        task.delay(0.3, function() ripple:Destroy() end)
        callback()
    end)
    return Btn
end

local function AddToggle(text, page, callback)
    local Frame = Instance.new("Frame", page)
    Frame.Size = UDim2.new(0.95, 0, 0, 38)
    Frame.BackgroundColor3 = Theme.Content
    CreateUICorner(Frame, 6)
    
    local Label = Instance.new("TextLabel", Frame)
    Label.Text = "  " .. text
    Label.TextColor3 = Theme.Text
    Label.Font = Enum.Font.GothamSemibold
    Label.TextSize = 13
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.TextXAlignment = Enum.TextXAlignment.Left
    
    local ToggleBtn = Instance.new("TextButton", Frame)
    ToggleBtn.Size = UDim2.new(0, 40, 0, 20)
    ToggleBtn.Position = UDim2.new(1, -50, 0.5, -10)
    ToggleBtn.BackgroundColor3 = Theme.Sidebar
    ToggleBtn.Text = ""
    CreateUICorner(ToggleBtn, 10)
    
    local Dot = Instance.new("Frame", ToggleBtn)
    Dot.Size = UDim2.new(0, 16, 0, 16)
    Dot.Position = UDim2.new(0, 2, 0.5, -8)
    Dot.BackgroundColor3 = Theme.SubText
    CreateUICorner(Dot, 8)
    
    local on = false
    ToggleBtn.MouseButton1Click:Connect(function()
        on = not on
        TweenService:Create(ToggleBtn, TweenInfo.new(0.2), {BackgroundColor3 = on and Theme.Accent or Theme.Sidebar}):Play()
        TweenService:Create(Dot, TweenInfo.new(0.2), {Position = on and UDim2.new(0, 22, 0.5, -8) or UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = on and Color3.new(1,1,1) or Theme.SubText}):Play()
        callback(on)
    end)
end

--// 5. HYBRID RECORDING ENGINE //

local Recorder = {
    Enabled = false,
    StartTime = 0,
    Data = {},       -- Linear timeline of Actions
    Connections = {} -- Event storage
}

local Replayer = {
    Active = false,
    Loop = false,
    Thread = nil
}

-- Stop Logic (Safety)
local function StopAll()
    Recorder.Enabled = false
    Replayer.Active = false
    Replayer.Loop = false
    
    -- Kill Threads
    if Replayer.Thread then task.cancel(Replayer.Thread) Replayer.Thread = nil end
    -- Disconnect Events
    for _, c in pairs(Recorder.Connections) do if c then c:Disconnect() end end
    Recorder.Connections = {}
end

local function StartRecording()
    StopAll() -- Clear previous state
    Recorder.Enabled = true
    Recorder.Data = {} -- Clear Buffer
    Recorder.StartTime = os.clock()
    
    local lastPos = nil
    
    -- A. INPUT STREAM (Touches/Clicks)
    local inputConn = UserInputService.InputBegan:Connect(function(input, gpe)
        if not Recorder.Enabled then return end
        
        -- Ignore typing but capture game inputs
        if gpe then 
            -- Note: We generally ignore typed text, but if capturing macro for game GUI, we might need GPE.
            -- For standard macros: Skip keyboard typing, allow GUI clicks.
            if input.UserInputType == Enum.UserInputType.Keyboard then return end 
        end 

        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            local pos = GetTruePosition(input)
            table.insert(Recorder.Data, {
                Type = "Input",
                Action = "Tap",
                Pos = pos,
                Delay = os.clock() - Recorder.StartTime
            })
        end
    end)
    table.insert(Recorder.Connections, inputConn)
    
    -- B. WORLD STREAM (Movement Checkpoints)
    -- Instead of InputMoved (noisy), we use Heartbeat to snapshot position
    local moveConn = RunService.Heartbeat:Connect(function()
        if not Recorder.Enabled then return end
        if not Player.Character or not Player.Character:FindFirstChild("HumanoidRootPart") then return end
        
        local Root = Player.Character.HumanoidRootPart
        local currentPos = Root.Position
        
        if not lastPos then lastPos = currentPos end
        
        -- Genius Logic: Only record a Waypoint if we moved meaningful distance (> 1 stud)
        -- Prevents recording idle jitter.
        if (currentPos - lastPos).Magnitude > 2 then
            table.insert(Recorder.Data, {
                Type = "Move",
                Pos = currentPos, -- Record 3D Vector3
                Delay = os.clock() - Recorder.StartTime
            })
            lastPos = currentPos
        end
    end)
    table.insert(Recorder.Connections, moveConn)
end

--// 6. PLAYBACK ENGINE (Threaded) //
local function ExecuteStream()
    local BaseOffset = Vector2.new(0, 0) -- For manual tweaking later
    
    for i, action in ipairs(Recorder.Data) do
        if not Replayer.Active then break end
        
        -- Logic: We check the delay relative to the *previous* action to stay synced, 
        -- or calculate delta from start. The robust way is delta from start.
        -- We calculate how much time HAS passed in replay vs how much SHOULD have passed.
        
        -- Simple approach: Wait for the specific timestamp
        -- (Ideally we calculate (StartTime + Action.Delay) - Now)
        
        -- Simplified delay loop:
        local prevAction = Recorder.Data[i-1]
        local waitTime = 0
        if prevAction then
            waitTime = action.Delay - prevAction.Delay
        else
            waitTime = action.Delay -- First action delay
        end
        
        if waitTime > 0 then task.wait(waitTime) end
        
        if action.Type == "Move" then
            -- Engage Smart Pathfinding Wrapper
            SmartMoveTo(action.Pos) 
            
        elseif action.Type == "Input" and action.Action == "Tap" then
            -- Engage Virtual Input Manager
            local finalX = action.Pos.X + BaseOffset.X
            local finalY = action.Pos.Y + BaseOffset.Y
            
            pcall(function()
                -- Mobile tap simulation (Press -> Wait -> Release)
                VirtualInputManager:SendMouseButtonEvent(finalX, finalY, 0, true, game, 1)
                task.wait(0.05)
                VirtualInputManager:SendMouseButtonEvent(finalX, finalY, 0, false, game, 1)
            end)
        end
    end
end

-- Thread Manager
local function ToggleReplay(shouldLoop)
    if Replayer.Active then
        StopAll() -- Force stop
        return false
    end
    
    if #Recorder.Data == 0 then return false end -- No data
    
    Replayer.Active = true
    Replayer.Loop = shouldLoop
    
    Replayer.Thread = task.spawn(function()
        while Replayer.Active do
            -- Pre-Check: Reset Character Alignment if needed? (Advanced: Teleport to start)
            -- For this version, we assume user starts near the start point.
            
            if Recorder.Data[1] and Recorder.Data[1].Type == "Move" then
                -- Optional: Teleport to start to ensure sync?
                -- Only if very far away? Let's rely on Pathfinding to get to the first point.
            end
            
            ExecuteStream()
            
            if not Replayer.Loop then break end
            task.wait(1) -- Pause before looping
        end
        Replayer.Active = false
        -- We'll need a UI update callback here later
    end)
    return true
end

-- // END OF PART 2 //
--// [PART 3: PAGE CONSTRUCTION & ASSEMBLY] //

-- Global Configs
local Config = {
    OffsetX = 0,
    OffsetY = 0,
    ShowVisuals = true
}

-- [TAB 1: HOME DASHBOARD]
local Home = CreateTab("Home", "üè†")

-- User Card
local Card = Instance.new("Frame", Home)
Card.Size = UDim2.new(1, -10, 0, 70)
Card.BackgroundColor3 = Theme.Content
CreateUICorner(Card, 8)
local UserImg = Instance.new("ImageLabel", Card)
UserImg.Size = UDim2.new(0, 50, 0, 50)
UserImg.Position = UDim2.new(0, 10, 0, 10)
UserImg.Image = Players:GetUserThumbnailAsync(Player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
CreateUICorner(UserImg, 25)
local Welcome = Instance.new("TextLabel", Card)
Welcome.Text = "Welcome, " .. Player.Name
Welcome.Size = UDim2.new(1, -70, 0, 30)
Welcome.Position = UDim2.new(0, 70, 0, 10)
Welcome.TextColor3 = Theme.Text
Welcome.Font = Enum.Font.GothamBold
Welcome.TextSize = 16
Welcome.TextXAlignment = Enum.TextXAlignment.Left
Welcome.BackgroundTransparency = 1
local Rank = Instance.new("TextLabel", Card)
Rank.Text = "Status: Hybrid Logic Active"
Rank.Size = UDim2.new(1, -70, 0, 20)
Rank.Position = UDim2.new(0, 70, 0, 40)
Rank.TextColor3 = Theme.Accent
Rank.Font = Enum.Font.Gotham
Rank.TextSize = 12
Rank.TextXAlignment = Enum.TextXAlignment.Left
Rank.BackgroundTransparency = 1

-- Instructions
local InfoBox = Instance.new("Frame", Home)
InfoBox.Size = UDim2.new(1, -10, 0, 100)
InfoBox.BackgroundColor3 = Theme.Sidebar
CreateUICorner(InfoBox, 6)
local InfoTxt = Instance.new("TextLabel", InfoBox)
InfoTxt.Text = "INSTRUCTIONS:\n1. Go to Macro Tab.\n2. Tap 'Record'.\n3. Walk & Click around.\n4. Stop & Replay.\n\n* Logic auto-switches between walking (Pathfinding) and clicking."
InfoTxt.Size = UDim2.new(1, -20, 1, -20)
InfoTxt.Position = UDim2.new(0,10,0,10)
InfoTxt.BackgroundTransparency = 1
InfoTxt.TextColor3 = Theme.SubText
InfoTxt.TextSize = 12
InfoTxt.TextXAlignment = Enum.TextXAlignment.Left
InfoTxt.TextYAlignment = Enum.TextYAlignment.Top
InfoTxt.Font = Enum.Font.Gotham

-- [TAB 2: MACRO CONTROLS]
local Macro = CreateTab("Macro", "‚ö°")

local StatusFrame = Instance.new("Frame", Macro)
StatusFrame.Size = UDim2.new(1, -10, 0, 40)
StatusFrame.BackgroundColor3 = Theme.Content
CreateUICorner(StatusFrame, 6)
local StatusLbl = Instance.new("TextLabel", StatusFrame)
StatusLbl.Text = "Status: IDLE"
StatusLbl.Size = UDim2.new(1, 0, 1, 0)
StatusLbl.BackgroundTransparency = 1
StatusLbl.Font = Enum.Font.GothamBlack
StatusLbl.TextSize = 14
StatusLbl.TextColor3 = Theme.SubText

-- Control Buttons
local RecBtn, StopBtn
RecBtn = AddButton("START RECORDING", Macro, function()
    if not Recorder.Enabled then
        StatusLbl.Text = "Status: RECORDING..."
        StatusLbl.TextColor3 = Theme.Danger
        RecBtn.Text = "Recording... (Tap to Cancel)"
        StartRecording()
    end
end, Theme.Content)

local Separator = Instance.new("Frame", Macro)
Separator.Size = UDim2.new(1,-10,0,2); Separator.BackgroundTransparency=1 -- Spacer

local PlayBtn = AddButton("REPLAY ACTIONS", Macro, function()
    StatusLbl.Text = "Status: PLAYING..."
    StatusLbl.TextColor3 = Theme.Success
    local success = ToggleReplay(false)
    if not success then StatusLbl.Text = "Status: NO DATA"; StatusLbl.TextColor3 = Theme.SubText end
end, Color3.fromRGB(40, 120, 80))

local LoopBtn = AddButton("LOOP PLAYBACK", Macro, function()
    StatusLbl.Text = "Status: LOOPING..."
    StatusLbl.TextColor3 = Theme.Warning
    local success = ToggleReplay(true)
    if not success then StatusLbl.Text = "Status: NO DATA"; StatusLbl.TextColor3 = Theme.SubText end
end, Color3.fromRGB(120, 90, 40))

StopBtn = AddButton("STOP ALL / CLEAR", Macro, function()
    StopAll()
    StatusLbl.Text = "Status: IDLE"
    StatusLbl.TextColor3 = Theme.SubText
    RecBtn.Text = "START RECORDING"
end, Theme.Danger)

-- [TAB 3: EXECUTOR (Safe Execution)]
local Exec = CreateTab("Execute", "üíª")
local ExecInput = Instance.new("TextBox", Exec)
ExecInput.Size = UDim2.new(1, -10, 0, 150)
ExecInput.BackgroundColor3 = Theme.Content
ExecInput.TextColor3 = Theme.Text
ExecInput.Font = Enum.Font.Code
ExecInput.TextSize = 12
ExecInput.PlaceholderText = "-- Paste Scripts Here --"
ExecInput.TextYAlignment = Enum.TextYAlignment.Top
ExecInput.TextXAlignment = Enum.TextXAlignment.Left
ExecInput.ClearTextOnFocus = false
CreateUICorner(ExecInput, 6)

AddButton("EXECUTE CODE", Exec, function()
    local code = ExecInput.Text
    local func, err = loadstring(code)
    if func then
        task.spawn(func)
        StatusLbl.Text = "Status: EXECUTED"
    else
        StatusLbl.Text = "Status: ERROR"
        warn("Execution Error: ", err)
    end
end, Theme.Accent)

AddButton("CLEAR BOX", Exec, function()
    ExecInput.Text = ""
end)

-- [TAB 4: SETTINGS & OFFSETS]
local Settings = CreateTab("Settings", "‚öôÔ∏è")

local OffL = Instance.new("TextLabel", Settings)
OffL.Text = "Pixel Offset Correction (X, Y)"
OffL.TextColor3 = Theme.SubText
OffL.BackgroundTransparency = 1
OffL.Size = UDim2.new(1, -10, 0, 20)
OffL.Font = Enum.Font.GothamBold
OffL.TextSize = 12

-- Dual Inputs for offsets
local BoxX = Instance.new("TextBox", Settings)
BoxX.PlaceholderText = "X: 0"
BoxX.Text = "0"
BoxX.Size = UDim2.new(0.45, 0, 0, 30)
BoxX.BackgroundColor3 = Theme.Content
BoxX.TextColor3 = Theme.Text
CreateUICorner(BoxX, 6)

local BoxY = Instance.new("TextBox", Settings)
BoxY.PlaceholderText = "Y: 0"
BoxY.Text = "0" -- Typically 36-58 on Mobile
BoxY.Size = UDim2.new(0.45, 0, 0, 30)
BoxY.Position = UDim2.new(0.5, 0, 0, 0) -- Relative to frame usually, but using Grid layout handled by logic
BoxY.BackgroundColor3 = Theme.Content
BoxY.TextColor3 = Theme.Text
CreateUICorner(BoxY, 6)

-- Manual position fix since UIListLayout in Tab stacks vertically
local OffsetCont = Instance.new("Frame", Settings)
OffsetCont.Size = UDim2.new(1, -10, 0, 35)
OffsetCont.BackgroundTransparency = 1
BoxX.Parent = OffsetCont
BoxY.Parent = OffsetCont

-- Logic update
BoxX.FocusLost:Connect(function() Config.OffsetX = tonumber(BoxX.Text) or 0 end)
BoxY.FocusLost:Connect(function() Config.OffsetY = tonumber(BoxY.Text) or 0 end)

AddToggle("Visualizer (Path Beams)", Settings, function(val)
    Config.ShowVisuals = val
    -- Toggles folder visibility
    local f = Workspace:FindFirstChild("AxioraVisuals")
    if f then for _,v in pairs(f:GetChildren()) do v.Transparency = val and 0.5 or 1 end end
end)

--// 7. VISUALIZER SYSTEM //
local VisualFolder = Instance.new("Folder", Workspace)
VisualFolder.Name = "AxioraVisuals"

local function AddVisualPoint(pos, color)
    if not Config.ShowVisuals then return end
    local p = Instance.new("Part")
    p.Size = Vector3.new(1,1,1)
    p.Position = pos
    p.Anchored = true
    p.CanCollide = false
    p.Material = Enum.Material.Neon
    p.Color = color
    p.Transparency = 0.5
    p.Shape = Enum.PartType.Ball
    p.Parent = VisualFolder
    
    -- Cleanup later
    task.delay(10, function() TweenService:Create(p, TweenInfo.new(1), {Transparency=1}):Play() end)
    task.delay(11, function() p:Destroy() end)
end

-- Hook Visuals into Recorder
task.spawn(function()
    while true do
        task.wait(0.5)
        if Recorder.Enabled then
             -- Simple feedback dot where player is
             if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
                 AddVisualPoint(Player.Character.HumanoidRootPart.Position, Theme.Warning)
             end
        end
    end
end)

-- Notification Helper
local function Notify(msg)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = "AXIORA V4";
            Text = msg;
            Duration = 3;
        })
    end)
end

Notify("Quantum Protocol Loaded. Delta Safe.")

-- Clean Loading
ContentArea:GetChildren()[1].Visible = true -- Show Home Tab first
