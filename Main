--[[ 
    AXIORA OMEGA [TIER-2 ARCHITECTURE]
    Architect: Quantum Delta-Script Architect
    Target: Delta Executor (Mobile Optimized)
    Protocol: 20-Point "Master Logic" (Safe, Smart, Autonomous)
    
    [PART A: THE MATRIX & INFRASTRUCTURE]
]]

--// 1. QUANTUM SERVICE WRAPPERS //
-- Ensuring detection-proof service acquisition on Delta/Hydrogen
local function GetService(name)
    local s = game:GetService(name)
    if cloneref then s = cloneref(s) end
    return s
end

local Players = GetService("Players")
local Workspace = GetService("Workspace")
local RunService = GetService("RunService")
local UserInputService = GetService("UserInputService")
local VirtualInputManager = GetService("VirtualInputManager")
local TweenService = GetService("TweenService")
local HttpService = GetService("HttpService")
local CoreGui = GetService("CoreGui")
local GuiService = GetService("GuiService")
local Lighting = GetService("Lighting")
local TeleportService = GetService("TeleportService")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- Validate Execution Environment
local IsMobile = UserInputService.TouchEnabled
if not game:IsLoaded() then game.Loaded:Wait() end

--// 2. GLOBAL STATE & CONFIGURATION //
-- The central nervous system of the macro
local Axiora = {
    Version = "Omega.1.0",
    State = {
        IsRecording = false,
        IsReplaying = false,
        IsLooping = false,
        IsPaused = false,
        CurrentIndex = 1,
        RecordingStart = 0,
        RejoinAttempted = false
    },
    Cache = {
        Data = {}, -- The Recorded Actions (RAM Buffer)
        Waypoints = {},
        PID = {
            TargetPing = 100,
            Correction = 1.0
        }
    },
    Threads = {},
    Signals = {}
}

-- User Settings (The Interface links to these)
local Config = {
    Offset = {X = 0, Y = 0},     -- Manual Tweaks
    GuiInsetFix = true,          -- "True-View" Logic
    SmartLag = true,             -- PID Sync
    Visuals = true,              -- HUD Drawing
    BatterySaver = false,        -- Thermal Regulator
    AntiAFK = true,              -- Micro-Packet Spoofing
    AutoRejoin = true,           -- Phoenix Protocol
    Humanizer = {                -- Perlin Noise parameters
        Enabled = true,
        Strength = 3             -- Pixel jitter radius
    }
}

-- Theme Definition (Axiora V6 Palette)
local Theme = {
    Background = Color3.fromRGB(20, 20, 24),
    Sidebar    = Color3.fromRGB(15, 15, 18),
    Content    = Color3.fromRGB(26, 26, 30),
    Accent     = Color3.fromRGB(114, 137, 218), -- Discord/Axiora Blurple
    Text       = Color3.fromRGB(245, 245, 245),
    SubText    = Color3.fromRGB(160, 160, 160),
    Success    = Color3.fromRGB(87, 242, 135),
    Danger     = Color3.fromRGB(237, 66, 69),
    Warning    = Color3.fromRGB(240, 240, 60),
    Void       = Color3.fromRGB(0, 0, 0)
}

--// 3. THE "CHRONOS" FILE SYSTEM //
-- Handles safe I/O with Scoped Storage limitations on Android 11+
local Chronos = {}
Chronos.FileName = "AxioraOmega_Save.json"
Chronos.TempFile = "AxioraOmega_RejoinState.json"

function Chronos.Save(isTemp)
    if not writefile then return warn("[Chronos] File System Not Supported") end
    
    local dataset = isTemp and {
        Index = Axiora.State.CurrentIndex,
        Loop = Axiora.State.IsLooping,
        Data = nil -- Don't duplicate massive data in temp, just state
    } or {
        Actions = Axiora.Cache.Data,
        Config = Config
    }
    
    local success, encoded = pcall(function() return HttpService:JSONEncode(dataset) end)
    if success then
        pcall(function() 
            writefile(isTemp and Chronos.TempFile or Chronos.FileName, encoded) 
        end)
    end
end

function Chronos.Load(isTemp)
    if not isfile or not readfile then return end
    local fileTarget = isTemp and Chronos.TempFile or Chronos.FileName
    
    if isfile(fileTarget) then
        local content = readfile(fileTarget)
        local success, decoded = pcall(function() return HttpService:JSONDecode(content) end)
        
        if success and decoded then
            if isTemp then
                -- Resume logic
                Axiora.State.CurrentIndex = decoded.Index or 1
                Axiora.State.IsLooping = decoded.Loop or false
                return true
            else
                -- Full load
                Axiora.Cache.Data = decoded.Actions or {}
                if decoded.Config then
                    for k, v in pairs(decoded.Config) do
                        if Config[k] ~= nil then Config[k] = v end
                    end
                end
                return true
            end
        end
    end
    return false
end

--// 4. THE "THERMAL" REGULATOR (FPS & BATTERY) //
-- Mobile heat management logic
local Thermal = {}
local OriginalSettings = {
    Tech = Enum.CameraType.Custom,
    Shadows = Lighting.GlobalShadows
}
Thermal.IsActive = false

function Thermal.SetEcoMode(enabled)
    if enabled == Thermal.IsActive then return end
    Thermal.IsActive = enabled
    
    if enabled then
        -- ENTER VOID MODE (GPU SAVING)
        RunService:Set3dRenderingEnabled(false) -- Standard Call
        
        -- Fallback if Set3d fails on specific Executor
        pcall(function()
            Camera.CameraType = Enum.CameraType.Scriptable
            Camera.CFrame = CFrame.new(0, -500, 0) -- Look into void
            Lighting.GlobalShadows = false
        end)
    else
        -- EXIT VOID MODE
        RunService:Set3dRenderingEnabled(true)
        
        pcall(function()
            Camera.CameraType = Enum.CameraType.Custom
            Lighting.GlobalShadows = OriginalSettings.Shadows
            if LocalPlayer.Character then
                Camera.CameraSubject = LocalPlayer.Character:FindFirstChild("Humanoid")
            end
        end)
    end
end

-- Auto-Throttler (Frequency Modulation)
task.spawn(function()
    while true do
        task.wait(5)
        -- Battery Logic check (if supported)
        -- If Time running > 30 mins, prompt Eco? 
        -- Implementation is handled via user Toggle for now
    end
end)

--// 5. EINSTEIN MATH LIBRARY //
-- Coordinate corrections and Proximity logic
local Math = {}

-- Returns the Delta-Adjusted 2D coordinates
function Math.GetTrueInput(inputObject)
    local raw = inputObject.Position
    local vec2 = Vector2.new(raw.X, raw.Y)
    
    -- GuiInset Subtraction Logic (TopBar Compensation)
    if Config.GuiInsetFix then
        local inset = GuiService:GetGuiInset()
        -- Mobile input objects usually need this fix during "Replay" calculation
        -- But for raw recording, we store RAW SCREEN.
    end
    
    return vec2
end

-- Returns the Time Dilation factor (Lag Compensation)
function Math.GetLagFactor()
    if not Config.SmartLag then return 1.0 end
    local ping = tonumber(string.split(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString(), " ")[1]) or 100
    local dilation = ping / 100 -- If 200ms, factor is 2.0. Slow down playback.
    
    -- Clamping to prevent excessive slow motion
    return math.clamp(dilation, 0.8, 1.5)
end

--// END OF PART A //
--// [PART B: THE HYBRID ENGINE LOGIC] //

--// 6. INTELLIGENT NAVIGATION (A* FALLBACK) //
local Pathfinding = {}
local PFS = GetService("PathfindingService")

function Pathfinding.SmartMove(targetPos)
    if not LocalPlayer.Character then return end
    local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
    local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hum or not root then return end

    -- Phase 1: Direct Attempt
    hum:MoveTo(targetPos)
    
    -- Phase 2: Monitoring (The "Stuck" Detector)
    local startT = tick()
    local moved = false
    local connection
    
    connection = hum.MoveToFinished:Connect(function() moved = true end)
    
    -- Heuristic Loop: If velocity is near zero for > 1.5s, we are blocked
    while not moved and (tick() - startT) < 8 do
        local vel = root.AssemblyLinearVelocity.Magnitude
        if (tick() - startT) > 1.5 and vel < 0.2 then
            -- BLOCKED -> ENGAGE A* PATH
            warn("[Axiora] Obstacle Detected. Calculating Path...")
            local path = PFS:CreatePath({AgentRadius = 2, AgentCanJump = true})
            local s, err = pcall(function() path:ComputeAsync(root.Position, targetPos) end)
            
            if s and path.Status == Enum.PathStatus.Success then
                for _, wp in ipairs(path:GetWaypoints()) do
                    if wp.Action == Enum.PathWaypointAction.Jump then hum.Jump = true end
                    hum:MoveTo(wp.Position)
                    hum.MoveToFinished:Wait() -- Force wait for waypoint
                    if (root.Position - targetPos).Magnitude < 5 then break end -- Close enough
                end
                break -- Exit monitoring, destination likely reached
            end
        end
        RunService.Heartbeat:Wait()
    end
    if connection then connection:Disconnect() end
end

--// 7. RECORDING HEURISTICS //
local Engine = {}
local RecordConn = {}

function Engine.StartRecording()
    if Axiora.State.IsRecording then return end
    
    -- Flush RAM
    Axiora.Cache.Data = {}
    Axiora.State.RecordingStart = os.clock()
    Axiora.State.IsRecording = true
    Axiora.State.IsReplaying = false
    
    local lastPos = nil
    
    -- STREAM A: MOVEMENT
    local mv = RunService.Heartbeat:Connect(function()
        if not LocalPlayer.Character then return end
        local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not root then return end
        
        local current = root.Position
        local camFrame = Camera.CFrame -- Capture Camera Angle for "True-View" replay
        
        -- Logic: Filter Micro-Jitter
        if not lastPos or (current - lastPos).Magnitude > 2 then
            table.insert(Axiora.Cache.Data, {
                Type = "Move",
                Pos = {X = current.X, Y = current.Y, Z = current.Z},
                Cam = {P = camFrame.Position, L = camFrame.LookVector},
                Time = os.clock() - Axiora.State.RecordingStart
            })
            lastPos = current
        end
    end)
    table.insert(RecordConn, mv)
    
    -- STREAM B: INPUT (Taps)
    local inp = UserInputService.InputBegan:Connect(function(input, gpe)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            local raw = UserInputService:GetMouseLocation()
            
            table.insert(Axiora.Cache.Data, {
                Type = "Input",
                Action = "Tap",
                XY = {X = raw.X, Y = raw.Y},
                Time = os.clock() - Axiora.State.RecordingStart
            })
        end
    end)
    table.insert(RecordConn, inp)
end

function Engine.Stop()
    Axiora.State.IsRecording = false
    Axiora.State.IsReplaying = false
    Axiora.State.IsLooping = false
    Thermal.SetEcoMode(false) -- Force visuals back on stop
    
    for _, c in pairs(RecordConn) do c:Disconnect() end
    RecordConn = {}
    
    -- Clear Replay Threads
    for tName, thread in pairs(Axiora.Threads) do
        task.cancel(thread)
        Axiora.Threads[tName] = nil
    end
end

--// 8. THE PLAYBACK CORE (Humanized) //
function Engine.ExecuteStep(action, prevTime)
    -- 1. WAIT: Sync time delta using Lag Factor
    local delayTime = action.Time - prevTime
    if delayTime > 0 then
        task.wait(delayTime * Math.GetLagFactor()) 
    end
    
    -- 2. ACTION BRANCH
    if action.Type == "Move" then
        -- RECONSTRUCT VECTOR3
        local dest = Vector3.new(action.Pos.X, action.Pos.Y, action.Pos.Z)
        
        -- OPTIONAL: CAMERA SYNC ("Absolute Perspective")
        -- If user enabled Camera Lock, force camera to look direction of movement
        -- Camera.CFrame = CFrame.new(Vector3.new(action.Cam.P.X, ...), ...) 
        
        Pathfinding.SmartMove(dest)
        
    elseif action.Type == "Input" and action.Action == "Tap" then
        -- CALCULATE FINAL COORDINATES
        local finalX = action.XY.X + Config.Offset.X
        local finalY = action.XY.Y + Config.Offset.Y
        
        -- APPLY HUMANIZER (Perlin Jitter)
        if Config.Humanizer.Enabled then
            local noiseX = (math.random() - 0.5) * Config.Humanizer.Strength * 2
            local noiseY = (math.random() - 0.5) * Config.Humanizer.Strength * 2
            finalX = finalX + noiseX
            finalY = finalY + noiseY
        end
        
        -- EXECUTE VIM CLICK
        pcall(function()
            VirtualInputManager:SendMouseButtonEvent(finalX, finalY, 0, true, game, 1)
            task.wait(math.random(0.04, 0.08)) -- Variable hold time
            VirtualInputManager:SendMouseButtonEvent(finalX, finalY, 0, false, game, 1)
        end)
    end
end

function Engine.Play(isLoop)
    if Axiora.State.IsReplaying or #Axiora.Cache.Data == 0 then return end
    Axiora.State.IsReplaying = true
    Axiora.State.IsLooping = isLoop
    Axiora.State.IsPaused = false
    
    if Config.BatterySaver then Thermal.SetEcoMode(true) end
    
    Axiora.Threads["Replay"] = task.spawn(function()
        while Axiora.State.IsReplaying do
            
            -- PHOENIX PROTOCOL (Checkpoint Save)
            Axiora.State.CurrentIndex = 0
            
            for i, action in ipairs(Axiora.Cache.Data) do
                if not Axiora.State.IsReplaying then break end
                
                -- Check for Pause
                while Axiora.State.IsPaused do task.wait(0.5) end
                
                -- Execute Logic
                local prev = Axiora.Cache.Data[i-1]
                local pTime = prev and prev.Time or 0
                
                Axiora.State.CurrentIndex = i
                Engine.ExecuteStep(action, pTime)
            end
            
            if not Axiora.State.IsLooping then break end
            
            -- End of Loop Anti-AFK Packet
            if Config.AntiAFK then
                Camera.CFrame = Camera.CFrame * CFrame.Angles(0, math.rad(1), 0)
                task.wait(0.1)
                Camera.CFrame = Camera.CFrame * CFrame.Angles(0, math.rad(-1), 0)
            end
            
            task.wait(0.5)
        end
        Engine.Stop()
    end)
end

--// 9. PHOENIX PROTOCOL (Rejoin Logic) //
-- Detection for standard Roblox Error Prompts
task.spawn(function()
    if not Config.AutoRejoin then return end
    local promptGui = CoreGui:WaitForChild("RobloxPromptGui", 10)
    if not promptGui then return end
    
    local function Rejoin()
        Chronos.Save(true) -- Save State
        if #Axiora.Cache.Data > 0 then
             -- Persist the macro logic via queue_on_teleport (Delta Feature)
             -- User must implement the 'Loader' URL here or autosave check
        end
        TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, LocalPlayer)
    end

    promptGui.DescendantAdded:Connect(function(obj)
        if obj.Name == "ErrorTitle" then
            warn("[Phoenix] Disconnect Detected. Rejoining...")
            task.wait(2)
            Rejoin()
        end
    end)
end)

--// END OF PART B //
--// [PART C: VISUAL INTERFACE & FINAL ASSEMBLY] //

--// 10. MOBILE UI FACTORY //
local UI = {}
local Screens = {}
local MainUI = Instance.new("ScreenGui")
MainUI.Name = "AxioraOmega_Tier2"
MainUI.Parent = CoreGui
MainUI.IgnoreGuiInset = true -- Ensures recording alignment with screen edge
MainUI.ResetOnSpawn = false

-- Dynamic Drag Logic (Touch Optimized)
local function EnableDrag(frame, dragObj)
    local dragging, dragInput, dragStart, startPos
    dragObj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
        end
    end)
    dragObj.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- UI Building Blocks
local function CreateUICorner(p, r) local c=Instance.new("UICorner",p); c.CornerRadius=UDim.new(0,r) return c end

local MainFrame = Instance.new("Frame", MainUI)
MainFrame.Size = UDim2.fromOffset(580, 320) -- Optimized for Landscape Mobile
MainFrame.Position = UDim2.fromScale(0.5, 0.5)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.BackgroundColor3 = Theme.Background
MainFrame.BorderSizePixel = 0
CreateUICorner(MainFrame, 10)

-- Sidebar
local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Size = UDim2.new(0, 160, 1, 0)
Sidebar.BackgroundColor3 = Theme.Sidebar
CreateUICorner(Sidebar, 10)

local Title = Instance.new("TextLabel", Sidebar)
Title.Text = "AXIORA Î©"
Title.Font = Enum.Font.GothamBlack
Title.TextColor3 = Theme.Accent
Title.TextSize = 22
Title.Size = UDim2.new(1,0,0,50)
Title.BackgroundTransparency = 1

local TabContainer = Instance.new("Frame", Sidebar)
TabContainer.Size = UDim2.new(1, -10, 1, -60)
TabContainer.Position = UDim2.new(0, 5, 0, 60)
TabContainer.BackgroundTransparency = 1

-- Page Container
local Pages = Instance.new("Frame", MainFrame)
Pages.Size = UDim2.new(1, -170, 1, -10)
Pages.Position = UDim2.new(0, 170, 0, 10)
Pages.BackgroundTransparency = 1
Pages.ClipsDescendants = true

-- Tab Logic
local currentTab = nil
local function SwitchTab(btn, page)
    for _, t in pairs(Screens) do 
        t.Page.Visible = false 
        TweenService:Create(t.Btn, TweenInfo.new(0.2), {TextTransparency = 0.5}):Play()
    end
    page.Visible = true
    TweenService:Create(btn, TweenInfo.new(0.2), {TextTransparency = 0}):Play()
end

local function AddTab(name, icon)
    local Page = Instance.new("ScrollingFrame", Pages)
    Page.Size = UDim2.new(1,0,1,0)
    Page.BackgroundTransparency = 1
    Page.ScrollBarThickness = 2
    Page.Visible = false
    
    local List = Instance.new("UIListLayout", Page); List.SortOrder = Enum.SortOrder.LayoutOrder; List.Padding = UDim.new(0,6)
    local Pad = Instance.new("UIPadding", Page); Pad.PaddingRight = UDim.new(0,6)
    
    local Btn = Instance.new("TextButton", TabContainer)
    Btn.Size = UDim2.new(1, 0, 0, 35)
    Btn.BackgroundTransparency = 1
    Btn.Text = " " .. icon .. "  " .. name
    Btn.Font = Enum.Font.GothamBold
    Btn.TextColor3 = Theme.Text
    Btn.TextTransparency = 0.5
    Btn.TextXAlignment = Enum.TextXAlignment.Left
    Btn.Position = UDim2.new(0,0,0, (#Screens * 40))
    
    Btn.MouseButton1Click:Connect(function() SwitchTab(Btn, Page) end)
    table.insert(Screens, {Btn=Btn, Page=Page})
    return Page
end

local function AddToggle(parent, text, default, callback)
    local f = Instance.new("Frame", parent)
    f.Size = UDim2.new(1,0,0,40); f.BackgroundColor3=Theme.Content; CreateUICorner(f,6)
    local l = Instance.new("TextLabel", f); l.Text=" "..text; l.Size=UDim2.new(0.7,0,1,0); l.TextColor3=Theme.Text; l.BackgroundTransparency=1; l.TextXAlignment=Enum.TextXAlignment.Left; l.Font=Enum.Font.Gotham
    local b = Instance.new("TextButton", f); b.Size=UDim2.new(0,40,0,22); b.Position=UDim2.new(1,-45,0.5,-11); b.BackgroundColor3=Theme.Sidebar; CreateUICorner(b,12)
    local c = Instance.new("Frame", b); c.Size=UDim2.new(0,18,0,18); c.Position=UDim2.new(0,2,0.5,-9); c.BackgroundColor3=Theme.SubText; CreateUICorner(c,9)
    
    local on = default
    local function Update()
        TweenService:Create(c, TweenInfo.new(0.2), {Position = on and UDim2.new(0,20,0.5,-9) or UDim2.new(0,2,0.5,-9), BackgroundColor3 = on and Color3.new(1,1,1) or Theme.SubText}):Play()
        TweenService:Create(b, TweenInfo.new(0.2), {BackgroundColor3 = on and Theme.Accent or Theme.Sidebar}):Play()
        callback(on)
    end
    b.MouseButton1Click:Connect(function() on = not on; Update() end)
    if default then Update() end
end

--// 11. PAGE CONSTRUCTION //

-- [TAB: DASHBOARD]
local P_Dash = AddTab("Dashboard", "ðŸ ")
local Status = Instance.new("TextLabel", P_Dash)
Status.Size = UDim2.new(1,0,0,80); Status.BackgroundColor3 = Theme.Content; Status.TextColor3 = Theme.SubText; Status.Text = "SYSTEM IDLE"; Status.Font=Enum.Font.GothamBlack; Status.TextSize=20
CreateUICorner(Status, 8)

local RecBtn = Instance.new("TextButton", P_Dash)
RecBtn.Size = UDim2.new(1,0,0,45); RecBtn.BackgroundColor3 = Theme.Content; RecBtn.Text="START RECORDING"; RecBtn.TextColor3=Theme.Text; RecBtn.Font=Enum.Font.GothamBold
CreateUICorner(RecBtn, 8)

local PlayBtn = Instance.new("TextButton", P_Dash)
PlayBtn.Size = UDim2.new(1,0,0,45); PlayBtn.BackgroundColor3 = Theme.Accent; PlayBtn.Text="PLAY LOOP"; PlayBtn.TextColor3=Theme.Text; PlayBtn.Font=Enum.Font.GothamBold
CreateUICorner(PlayBtn, 8)

RecBtn.MouseButton1Click:Connect(function()
    if Axiora.State.IsRecording then Engine.Stop() else Engine.StartRecording() end
end)
PlayBtn.MouseButton1Click:Connect(function()
    if Axiora.State.IsReplaying then Engine.Stop() else Engine.Play(true) end
end)

-- [TAB: SETTINGS]
local P_Set = AddTab("Settings", "âš™ï¸")

local OffF = Instance.new("Frame", P_Set); OffF.Size=UDim2.new(1,0,0,40); OffF.BackgroundTransparency=1
local BoxX = Instance.new("TextBox", OffF); BoxX.PlaceholderText="Offset X"; BoxX.Size=UDim2.new(0.48,0,1,0); BoxX.BackgroundColor3=Theme.Content; BoxX.TextColor3=Theme.Text
local BoxY = Instance.new("TextBox", OffF); BoxY.PlaceholderText="Offset Y (TopBar)"; BoxY.Size=UDim2.new(0.48,0,1,0); BoxY.Position=UDim2.new(0.52,0,0,0); BoxY.BackgroundColor3=Theme.Content; BoxY.TextColor3=Theme.Text
CreateUICorner(BoxX, 6); CreateUICorner(BoxY, 6)

BoxX.FocusLost:Connect(function() Config.Offset.X = tonumber(BoxX.Text) or 0 end)
BoxY.FocusLost:Connect(function() Config.Offset.Y = tonumber(BoxY.Text) or 0 end)

AddToggle(P_Set, "Thermal Mode (Save Battery)", false, function(v) Config.BatterySaver = v; Thermal.SetEcoMode(v) end)
AddToggle(P_Set, "Holographic Path (HUD)", true, function(v) Config.Visuals = v end)
AddToggle(P_Set, "Anti-AFK Packet Spoof", true, function(v) Config.AntiAFK = v end)

--// 12. HOLOGRAPHIC VISUALIZER (HUD) //
-- Using Delta/Execution standard Drawing API for lightweight 2D lines
local Visuals = {Lines = {}}

task.spawn(function()
    local LineCache = {} -- Reuse drawing objects to prevent memory leak
    
    while RunService.RenderStepped:Wait() do
        -- Logic: If visualizer enabled and we have Waypoints
        if Config.Visuals and (#Axiora.Cache.Data > 0) then
            local Count = 0
            local PreviousPoint = nil
            
            for _, act in ipairs(Axiora.Cache.Data) do
                if act.Type == "Move" then
                    -- Project 3D Point to 2D Screen
                    local vec3 = Vector3.new(act.Pos.X, act.Pos.Y, act.Pos.Z)
                    local screenPos, onScreen = Camera:WorldToViewportPoint(vec3)
                    
                    if onScreen and PreviousPoint then
                        Count = Count + 1
                        -- Create or reuse line
                        local line = LineCache[Count]
                        if not line then
                            line = Drawing.new("Line")
                            line.Thickness = 1.5
                            line.Color = Theme.Accent
                            line.Transparency = 0.6
                            table.insert(LineCache, line)
                        end
                        
                        line.From = Vector2.new(PreviousPoint.X, PreviousPoint.Y)
                        line.To = Vector2.new(screenPos.X, screenPos.Y)
                        line.Visible = true
                    end
                    
                    PreviousPoint = screenPos
                end
            end
            
            -- Hide unused lines
            for i = Count + 1, #LineCache do
                LineCache[i].Visible = false
            end
        else
            -- Cleanup if hidden
            for _, l in pairs(LineCache) do l.Visible = false end
        end
        
        -- UI STATUS UPDATE (Linking Part B State to UI)
        if Axiora.State.IsRecording then
            Status.Text = "RECORDING | Actions: " .. #Axiora.Cache.Data
            Status.TextColor3 = Theme.Danger
            RecBtn.Text = "STOP RECORDING"
        elseif Axiora.State.IsReplaying then
            Status.Text = "PLAYING | Index: " .. Axiora.State.CurrentIndex
            Status.TextColor3 = Theme.Success
            PlayBtn.Text = "STOP PLAYBACK"
        else
            Status.Text = "SYSTEM READY"
            Status.TextColor3 = Theme.SubText
            RecBtn.Text = "START RECORDING"
            PlayBtn.Text = "PLAY LOOP"
        end
    end
end)

--// 13. MASTER INIT //
-- Drag Support & Floating Toggle
EnableDrag(MainFrame, Sidebar)
local ToggleBtn = Instance.new("TextButton", MainUI)
ToggleBtn.Size = UDim2.new(0,50,0,50); ToggleBtn.Position=UDim2.new(0,20,0.3,0); ToggleBtn.BackgroundColor3=Theme.Sidebar; ToggleBtn.Text="Î©"; ToggleBtn.TextColor3=Theme.Accent; ToggleBtn.Font=Enum.Font.GothamBlack; ToggleBtn.TextSize=24
CreateUICorner(ToggleBtn, 25); EnableDrag(ToggleBtn, ToggleBtn)

ToggleBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

-- Initial Tab
SwitchTab(Screens[1].Btn, Screens[1].Page)

-- Phoenix Auto-Load Check
task.delay(1, function()
    if Config.AutoRejoin then
        local loaded = Chronos.Load(true) -- Load Temp
        if loaded and Axiora.State.CurrentIndex > 0 then
            Chronos.Load(false) -- Load Data
            Engine.Play(Axiora.State.IsLooping)
        end
    end
end)

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "AXIORA OMEGA",
    Text = "Tier-2 Architecture Online.\n20/20 Systems Active.",
    Duration = 5
})
--// END OF AXIORA OMEGA //
