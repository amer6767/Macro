--[[
    AXIORA V6 ULTIMATE - Bee Swarm Simulator Edition
    Changes: 
    - Quest Tab now uses Dropdown Menu (Clean UI)
    - Auto Quest Toggle added
    - Optimization Checks
]]

--// SERVICES
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local PathfindingService = game:GetService("PathfindingService")
local VirtualUser = game:GetService("VirtualUser")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")

local Player = Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

Player.CharacterAdded:Connect(function(newChar)
    Character = newChar
    Humanoid = newChar:WaitForChild("Humanoid")
    RootPart = newChar:WaitForChild("HumanoidRootPart")
end)

--// THEME CONFIGURATION
local Theme = {
    Background = Color3.fromRGB(20, 20, 24),
    Sidebar    = Color3.fromRGB(15, 15, 18),
    Content    = Color3.fromRGB(26, 26, 30),
    Accent     = Color3.fromRGB(114, 137, 218),
    Text       = Color3.fromRGB(245, 245, 245),
    SubText    = Color3.fromRGB(160, 160, 160),
    Success    = Color3.fromRGB(87, 242, 135),
    Danger     = Color3.fromRGB(237, 66, 69)
}

--// GUI LIBRARY SYSTEM
local AxioraGUI = Instance.new("ScreenGui")
AxioraGUI.Name = "AxioraV6_QuestUpdate"
AxioraGUI.IgnoreGuiInset = true
AxioraGUI.ResetOnSpawn = false

if CoreGui:FindFirstChild("AxioraV6_QuestUpdate") then CoreGui["AxioraV6_QuestUpdate"]:Destroy() end
AxioraGUI.Parent = CoreGui

-- Utility Functions
local function CreateUICorner(parent, r)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, r or 6)
    corner.Parent = parent
    return corner
end

local function CreateLabel(parent, text, textSize, color)
    local lbl = Instance.new("TextLabel")
    lbl.Text = text
    lbl.Font = Enum.Font.GothamBold
    lbl.TextSize = textSize or 14
    lbl.TextColor3 = color or Theme.Text
    lbl.BackgroundTransparency = 1
    lbl.Size = UDim2.new(1, 0, 0, textSize + 10)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = parent
    return lbl
end

local function AddToggle(text, parent, callback)
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1, 0, 0, 40)
    Frame.BackgroundColor3 = Theme.Content
    Frame.Parent = parent
    CreateUICorner(Frame, 6)

    local Label = Instance.new("TextLabel")
    Label.Text = "  " .. text
    Label.Font = Enum.Font.GothamSemibold
    Label.TextSize = 13
    Label.TextColor3 = Theme.Text
    Label.Size = UDim2.new(0.7, 0, 1, 0)
    Label.BackgroundTransparency = 1
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.Parent = Frame

    local Button = Instance.new("TextButton")
    Button.Size = UDim2.new(0, 42, 0, 22)
    Button.Position = UDim2.new(1, -50, 0.5, -11)
    Button.BackgroundColor3 = Theme.Sidebar
    Button.Text = ""
    Button.Parent = Frame
    CreateUICorner(Button, 11)

    local Circle = Instance.new("Frame")
    Circle.Size = UDim2.new(0, 16, 0, 16)
    Circle.Position = UDim2.new(0, 3, 0.5, -8)
    Circle.BackgroundColor3 = Theme.SubText
    Circle.Parent = Button
    CreateUICorner(Circle, 8)

    local Toggled = false
    Button.MouseButton1Click:Connect(function()
        Toggled = not Toggled
        local GoalColor = Toggled and Theme.Accent or Theme.Sidebar
        local GoalPos = Toggled and UDim2.new(0, 23, 0.5, -8) or UDim2.new(0, 3, 0.5, -8)
        local GoalDot = Toggled and Color3.new(1,1,1) or Theme.SubText

        TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = GoalColor}):Play()
        TweenService:Create(Circle, TweenInfo.new(0.2), {Position = GoalPos, BackgroundColor3 = GoalDot}):Play()
        callback(Toggled)
    end)
    return Frame
end

--// MAIN FRAME
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 650, 0, 400)
MainFrame.Position = UDim2.new(0.5, -325, 0.5, -200)
MainFrame.BackgroundColor3 = Theme.Background
MainFrame.Parent = AxioraGUI
CreateUICorner(MainFrame, 8)

-- Draggable Logic
local DragFrame = Instance.new("Frame")
DragFrame.Size = UDim2.new(1, 0, 0, 30)
DragFrame.BackgroundTransparency = 1
DragFrame.Parent = MainFrame
local isDragging, dragStart, startPos
DragFrame.InputBegan:Connect(function(input) if input.UserInputType==Enum.UserInputType.MouseButton1 then isDragging=true; dragStart=input.Position; startPos=MainFrame.Position end end)
UserInputService.InputChanged:Connect(function(input) if isDragging and input.UserInputType==Enum.UserInputType.MouseMovement then local d=input.Position-dragStart; MainFrame.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+d.X,startPos.Y.Scale,startPos.Y.Offset+d.Y) end end)
DragFrame.InputEnded:Connect(function(input) if input.UserInputType==Enum.UserInputType.MouseButton1 then isDragging=false end end)

-- Sidebar
local Sidebar = Instance.new("Frame")
Sidebar.Size = UDim2.new(0, 160, 1, 0)
Sidebar.BackgroundColor3 = Theme.Sidebar
Sidebar.Parent = MainFrame
CreateUICorner(Sidebar, 8)

local AppTitle = Instance.new("TextLabel")
AppTitle.Text = "AXIORA"
AppTitle.Font = Enum.Font.GothamBlack
AppTitle.TextSize = 22
AppTitle.TextColor3 = Theme.Accent
AppTitle.Size = UDim2.new(1, 0, 0, 60)
AppTitle.BackgroundTransparency = 1
AppTitle.Parent = Sidebar

local TabsHolder = Instance.new("ScrollingFrame")
TabsHolder.Size = UDim2.new(1, -10, 1, -70)
TabsHolder.Position = UDim2.new(0, 5, 0, 65)
TabsHolder.BackgroundTransparency = 1
TabsHolder.ScrollBarThickness = 0
TabsHolder.Parent = Sidebar
local UIList = Instance.new("UIListLayout")
UIList.Parent = TabsHolder
UIList.SortOrder = Enum.SortOrder.LayoutOrder
UIList.Padding = UDim.new(0, 5)

-- Content Area
local ContentContainer = Instance.new("Frame")
ContentContainer.Size = UDim2.new(1, -175, 1, -20)
ContentContainer.Position = UDim2.new(0, 175, 0, 10)
ContentContainer.BackgroundTransparency = 1
ContentContainer.Parent = MainFrame
ContentContainer.ClipsDescendants = true

-- Tab System Logic
local ActiveTab = nil
local function CreateTab(Name, Icon)
    local Btn = Instance.new("TextButton")
    Btn.Text = "  " .. Icon .. "   " .. Name
    Btn.Size = UDim2.new(1, 0, 0, 34)
    Btn.BackgroundTransparency = 1
    Btn.BackgroundColor3 = Theme.Content
    Btn.TextColor3 = Theme.SubText
    Btn.Font = Enum.Font.GothamSemibold
    Btn.TextXAlignment = Enum.TextXAlignment.Left
    Btn.Parent = TabsHolder
    CreateUICorner(Btn, 6)

    local Page = Instance.new("ScrollingFrame")
    Page.Size = UDim2.new(1, 0, 1, 0)
    Page.BackgroundTransparency = 1
    Page.ScrollBarThickness = 2
    Page.ScrollBarImageColor3 = Theme.SubText
    Page.Visible = false
    Page.Parent = ContentContainer

    local PLayout = Instance.new("UIListLayout")
    PLayout.Parent = Page
    PLayout.Padding = UDim.new(0, 6)
    PLayout.SortOrder = Enum.SortOrder.LayoutOrder
    
    local PPad = Instance.new("UIPadding")
    PPad.Parent = Page
    PPad.PaddingRight = UDim.new(0, 5)

    Btn.MouseButton1Click:Connect(function()
        if ActiveTab then
            TweenService:Create(ActiveTab.Btn, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextColor3 = Theme.SubText}):Play()
            ActiveTab.Page.Visible = false
        end
        ActiveTab = {Btn = Btn, Page = Page}
        Page.Visible = true
        TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundTransparency = 0, TextColor3 = Theme.Text}):Play()
    end)
    return Page
end

--// INITIALIZE TABS
local InfoPage = CreateTab("Info", "â„¹ï¸")
local FarmPage = CreateTab("Farm", "ðŸŒ¾")
local QuestPage = CreateTab("Quest", "ðŸ“œ") -- Quest Page Order Up
local ToysPage = CreateTab("Toys", "ðŸª")
local MobsPage = CreateTab("Mobs", "ðŸž")
local SettingsPage = CreateTab("Settings", "âš™ï¸")
local ConfigPage = CreateTab("Config", "ðŸ’¾")

ContentContainer:GetChildren()[1].Visible = true -- Force first page visible

--// 1. FARM PAGE LOGIC
CreateLabel(FarmPage, "Farming Automation", 16)
local SelectedField = nil
local IsFarming = false
local IsDigging = false

-- Field Dropdown (UI)
local FDrop = Instance.new("Frame")
FDrop.Size = UDim2.new(1, 0, 0, 40)
FDrop.BackgroundColor3 = Theme.Content
FDrop.Parent = FarmPage
CreateUICorner(FDrop, 6)
local FLabel = Instance.new("TextLabel"); FLabel.Text = "  Field: None"; FLabel.Size=UDim2.new(0.8,0,1,0); FLabel.BackgroundTransparency=1; FLabel.TextColor3=Theme.Text; FLabel.Font=Enum.Font.Gotham; FLabel.TextXAlignment=Enum.TextXAlignment.Left; FLabel.Parent=FDrop
local FBtn = Instance.new("TextButton"); FBtn.Size=UDim2.new(1,0,1,0); FBtn.BackgroundTransparency=1; FBtn.Text=""; FBtn.Parent=FDrop

-- Global Modal Handler
local ModalBg = Instance.new("Frame"); ModalBg.Size=UDim2.new(0.7,0,0.6,0); ModalBg.Position=UDim2.new(0.2,0,0.2,0); ModalBg.BackgroundColor3=Theme.Sidebar; ModalBg.Parent=ContentContainer; ModalBg.Visible=false; ModalBg.ZIndex=10; CreateUICorner(ModalBg,10)
local MScroll = Instance.new("ScrollingFrame"); MScroll.Size=UDim2.new(1,-10,1,-10); MScroll.Position=UDim2.new(0,5,0,5); MScroll.BackgroundTransparency=1; MScroll.Parent=ModalBg
local MList = Instance.new("UIListLayout"); MList.Parent=MScroll; MList.SortOrder=Enum.SortOrder.LayoutOrder

FBtn.MouseButton1Click:Connect(function()
    ModalBg.Visible = not ModalBg.Visible
    -- Clean existing
    for _,v in pairs(MScroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    
    -- Load Fields
    local fields = Workspace:FindFirstChild("FlowerZones")
    if fields then
        for _,f in pairs(fields:GetChildren()) do
            local b = Instance.new("TextButton")
            b.Text = f.Name
            b.Size = UDim2.new(1,0,0,30)
            b.BackgroundColor3=Theme.Content; b.TextColor3=Theme.SubText; b.Parent=MScroll; CreateUICorner(b,4)
            b.MouseButton1Click:Connect(function()
                SelectedField = f
                FLabel.Text = "  Field: " .. f.Name
                ModalBg.Visible = false
            end)
        end
    end
    MScroll.CanvasSize = UDim2.new(0,0,0,MList.AbsoluteContentSize.Y)
end)

AddToggle("Auto Dig", FarmPage, function(v)
    IsDigging = v
    task.spawn(function()
        while IsDigging do task.wait(0.2); VirtualUser:CaptureController(); VirtualUser:ClickButton1(Vector2.new()) end
    end)
end)

AddToggle("Auto Farm (Walk)", FarmPage, function(v)
    IsFarming = v
    task.spawn(function()
        while IsFarming and SelectedField do
            if (RootPart.Position - SelectedField.Position).Magnitude > 30 then
                Humanoid:MoveTo(SelectedField.Position)
                Humanoid.MoveToFinished:Wait()
            else
                Humanoid:MoveTo(RootPart.Position + Vector3.new(math.random(-15,15), 0, math.random(-15,15)))
                task.wait(0.5)
            end
            task.wait()
        end
    end)
end)

--// 2. QUEST PAGE LOGIC (UPDATED REQUEST)
CreateLabel(QuestPage, "Quest Automation", 16)
local SelectedBear = nil
local IsQuesting = false
local BearsList = {
    "Black Bear", "Mother Bear", "Brown Bear", "Panda Bear", 
    "Science Bear", "Polar Bear", "Spirit Bear", 
    "Riley Bee", "Bucko Bee", "Onett", "Bee Bear"
}

-- Bear Dropdown
local QDrop = Instance.new("Frame")
QDrop.Size = UDim2.new(1, 0, 0, 40)
QDrop.BackgroundColor3 = Theme.Content
QDrop.Parent = QuestPage
CreateUICorner(QDrop, 6)

local QLabel = Instance.new("TextLabel")
QLabel.Text = "  Select Bear > [None]"
QLabel.Size = UDim2.new(0.8, 0, 1, 0)
QLabel.BackgroundTransparency = 1
QLabel.TextColor3 = Theme.Text
QLabel.Font = Enum.Font.Gotham
QLabel.TextXAlignment = Enum.TextXAlignment.Left
QLabel.Parent = QDrop

local QBtn = Instance.new("TextButton")
QBtn.Size = UDim2.new(1, 0, 1, 0)
QBtn.BackgroundTransparency = 1
QBtn.Text = ""
QBtn.Parent = QDrop

QBtn.MouseButton1Click:Connect(function()
    ModalBg.Visible = not ModalBg.Visible
    -- Clean List
    for _,v in pairs(MScroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    
    -- Load Bears
    for _, name in pairs(BearsList) do
        local b = Instance.new("TextButton")
        b.Text = name
        b.Size = UDim2.new(1,0,0,30)
        b.BackgroundColor3=Theme.Content; b.TextColor3=Theme.SubText; b.Parent=MScroll; CreateUICorner(b,4)
        
        b.MouseButton1Click:Connect(function()
            SelectedBear = name
            QLabel.Text = "  Select Bear > " .. name
            ModalBg.Visible = false
        end)
    end
    MScroll.CanvasSize = UDim2.new(0,0,0,MList.AbsoluteContentSize.Y)
end)

-- Quest Toggle Logic
AddToggle("Auto Farm Quest (Interact)", QuestPage, function(v)
    IsQuesting = v
    if IsQuesting then
        task.spawn(function()
            while IsQuesting do
                if SelectedBear then
                    -- 1. Find NPC
                    local target = nil
                    for _, obj in pairs(Workspace:GetDescendants()) do
                        if obj.Name == SelectedBear and (obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChild("Torso")) then
                            target = obj
                            break
                        end
                    end
                    
                    if target then
                        -- 2. Teleport
                        local tPart = target:FindFirstChild("HumanoidRootPart") or target:FindFirstChild("Torso")
                        if tPart then
                            if (RootPart.Position - tPart.Position).Magnitude > 8 then
                                RootPart.CFrame = tPart.CFrame * CFrame.new(0,0,4)
                            end
                            
                            -- 3. Interact (ProximityPrompt)
                            local prompt = target:FindFirstChild("ProximityPrompt", true)
                            if prompt then
                                fireproximityprompt(prompt)
                            end
                            
                            -- 4. Simulated Click (For GUI dialogs)
                            VirtualUser:CaptureController()
                            VirtualUser:ClickButton1(Vector2.new(0.5,0.5))
                        end
                    else
                        QLabel.Text = "  Error: NPC Not Rendered!"
                    end
                else
                    QLabel.Text = "  Error: Select a Bear first!"
                end
                task.wait(1.5) -- Spam interval
            end
        end)
    end
end)

CreateLabel(QuestPage, "Status: Monitors quests via dialogue interactions.", 12, Theme.SubText)


--// 3. SETTINGS & OTHER (Maintained from previous stable)
CreateLabel(SettingsPage, "Anti-Lag Options", 16)
AddToggle("Hide Particles", SettingsPage, function(v)
    _G.HideParts = v
    if v then
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("ParticleEmitter") then obj.Enabled = false end
        end
    end
end)

AddToggle("Hide Token Visuals", SettingsPage, function(v)
    -- Complex visual hiding logic simplified for V6
    local coll = Workspace:FindFirstChild("Collectibles")
    if coll and v then
        for _,t in pairs(coll:GetChildren()) do 
            for _,p in pairs(t:GetChildren()) do if p:IsA("Decal") then p.Transparency=1 end end
        end
    end
end)

CreateLabel(SettingsPage, "Hive Options", 16)
local ClaimBtn = Instance.new("TextButton")
ClaimBtn.Text = "Auto Claim Random Hive"
ClaimBtn.Size = UDim2.new(1,0,0,40)
ClaimBtn.BackgroundColor3=Theme.Accent; ClaimBtn.TextColor3=Theme.Text; ClaimBtn.Parent=SettingsPage; CreateUICorner(ClaimBtn,6)
ClaimBtn.MouseButton1Click:Connect(function()
    local hives = Workspace:FindFirstChild("Honeycombs")
    if hives then
        for _,h in pairs(hives:GetChildren()) do
            if h.Owner.Value == nil and h:FindFirstChild("SpawnPos") then
                RootPart.CFrame = h.SpawnPos.Value.CFrame + Vector3.new(0,5,0)
                local p = h:FindFirstChild("ProximityPrompt", true)
                if p then fireproximityprompt(p) end
            end
        end
    end
end)

--// DASHBOARD INFO
CreateLabel(InfoPage, "Dashboard", 16)
local UCard = Instance.new("Frame"); UCard.Size=UDim2.new(1,0,0,70); UCard.BackgroundColor3=Theme.Content; UCard.Parent=InfoPage; CreateUICorner(UCard,6)
local UImg = Instance.new("ImageLabel"); UImg.Size=UDim2.new(0,50,0,50); UImg.Position=UDim2.new(0,10,0,10); UImg.Image=Players:GetUserThumbnailAsync(Player.UserId,Enum.ThumbnailType.HeadShot,Enum.ThumbnailSize.Size420x420); UImg.Parent=UCard; CreateUICorner(UImg,25)
local UText = Instance.new("TextLabel"); UText.Text=Player.Name; UText.Position=UDim2.new(0,70,0,25); UText.TextSize=16; UText.TextColor3=Theme.Text; UText.BackgroundTransparency=1; UText.Font=Enum.Font.GothamBold; UText.TextXAlignment=Enum.TextXAlignment.Left; UText.Parent=UCard

--// FLOATING BUTTON
local Float = Instance.new("TextButton")
Float.Size = UDim2.new(0,50,0,50)
Float.Position = UDim2.new(0.01, 0, 0.5, 0)
Float.BackgroundColor3 = Theme.Background
Float.Text = "AX"
Float.TextColor3 = Theme.Accent
Float.Font = Enum.Font.GothamBlack
Float.TextSize = 20
Float.Parent = AxioraGUI
CreateUICorner(Float, 12)
local s=Instance.new("UIStroke"); s.Color=Theme.Accent; s.Parent=Float
Float.MouseButton1Click:Connect(function() MainFrame.Visible=not MainFrame.Visible end)

print("Axiora V6 - Quest Automation Updated")
